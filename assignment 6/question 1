#include <iostream>
using namespace std;

struct Node {
    int data;
    Node* next;
    Node* prev;
};

Node* newNode(int data) {
    Node* temp = new Node;
    temp->data = data;
    temp->next = temp->prev = nullptr;
    return temp;
}
void display(Node* head) {
    if (head == nullptr) {
        cout << "List is empty." << endl;
        return;
    }

    Node* temp = head;
    cout << "Circular Doubly Linked List: ";
    do {
        cout << temp->data << " ";
        temp = temp->next;
    } while (temp != head);
    cout << endl;
}

void insertAtBeginning(Node*& head, int data) {
    Node* temp = newNode(data);
    if (head == nullptr) {
        head = temp;
        head->next = head->prev = head;
    } else {
        Node* last = head->prev;
        temp->next = head;
        temp->prev = last;
        last->next = temp;
        head->prev = temp;
        head = temp;
    }
    cout << "Node inserted at beginning.\n";
}

void insertAtEnd(Node*& head, int data) {
    Node* temp = newNode(data);
    if (head == nullptr) {
        head = temp;
        head->next = head->prev = head;
    } else {
        Node* last = head->prev;
        temp->next = head;
        temp->prev = last;
        last->next = temp;
        head->prev = temp;
    }
    cout << "Node inserted at end.\n";
}
void insertAfter(Node* head, int key, int data) {
    if (head == nullptr) {
        cout << "List is empty.\n";
        return;
    }
    Node* temp = head;
    do {
        if (temp->data == key) {
            Node* new_node = newNode(data);
            new_node->next = temp->next;
            new_node->prev = temp;
            temp->next->prev = new_node;
            temp->next = new_node;
            cout << "Node inserted after " << key << ".\n";
            return;
        }
        temp = temp->next;
    } while (temp != head);

    cout << "Node with data " << key << " not found.\n";
}

void insertBefore(Node*& head, int key, int data) {
    if (head == nullptr) {
        cout << "List is empty.\n";
        return;
    }

    Node* temp = head;
    do {
        if (temp->data == key) {
            Node* new_node = newNode(data);
            new_node->next = temp;
            new_node->prev = temp->prev;
            temp->prev->next = new_node;
            temp->prev = new_node;
            if (temp == head)
                head = new_node; 
            cout << "Node inserted before " << key << ".\n";
            return;
        }
        temp = temp->next;
    } while (temp != head);

    cout << "Node with data " << key << " not found.\n";
}

void deleteNode(Node*& head, int key) {
    if (head == nullptr) {
        cout << "List is empty.\n";
        return;
    }

    Node* curr = head;
    Node* prev = nullptr;

    do {
        if (curr->data == key) {
            if (curr->next == curr && curr->prev == curr) {
                delete curr;
                head = nullptr;
            } else {
                curr->prev->next = curr->next;
                curr->next->prev = curr->prev;
                if (curr == head)
                    head = curr->next;
                delete curr;
            }
            cout << "Node " << key << " deleted.\n";
            return;
        }
        curr = curr->next;
    } while (curr != head);

    cout << "Node with data " << key << " not found.\n";
}

void searchNode(Node* head, int key) {
    if (head == nullptr) {
        cout << "List is empty.\n";
        return;
    }

    Node* temp = head;
    int pos = 1;
    do {
        if (temp->data == key) {
            cout << "Node " << key << " found at position " << pos << ".\n";
            return;
        }
        temp = temp->next;
        pos++;
    } while (temp != head);

    cout << "Node " << key << " not found.\n";
}

int main() {
    Node* head = nullptr;
    int choice, data, key;

    while (true) {
        cout << "\n===== Circular Doubly Linked List Menu =====\n";
        cout << "1. Insert at Beginning\n";
        cout << "2. Insert at End\n";
        cout << "3. Insert After a Node\n";
        cout << "4. Insert Before a Node\n";
        cout << "5. Delete a Node\n";
        cout << "6. Search for a Node\n";
        cout << "7. Display the List\n";
        cout << "8. Exit\n";
        cout << "Enter your choice: ";
        cin >> choice;

        switch (choice) {
        case 1:
            cout << "Enter data: ";
            cin >> data;
            insertAtBeginning(head, data);
            break;
        case 2:
            cout << "Enter data: ";
            cin >> data;
            insertAtEnd(head, data);
            break;
        case 3:
            cout << "Enter key (insert after): ";
            cin >> key;
            cout << "Enter data: ";
            cin >> data;
            insertAfter(head, key, data);
            break;
        case 4:
            cout << "Enter key (insert before): ";
            cin >> key;
            cout << "Enter data: ";
            cin >> data;
            insertBefore(head, key, data);
            break;
        case 5:
            cout << "Enter key to delete: ";
            cin >> key;
            deleteNode(head, key);
            break;
        case 6:
            cout << "Enter key to search: ";
            cin >> key;
            searchNode(head, key);
            break;
        case 7:
            display(head);
            break;
        case 8:
            cout << "Exiting program.\n";
            return 0;
        default:
            cout << "Invalid choice! Try again.\n";
        }
    }
    return 0;
}
